#!/bin/sh 
# checking for existence of sample -- this file gives the sha256 of the malware
FILE=`cat malware_output.txt`

if [ -f $FILE ];
then

	sha1_hash=$(sha1sum $FILE | awk '{print $1}')    # malware samples are named after their sha1sums
	# echo $sha1_hash
	# echo $FILE

	# checking if the .pcap and .strace files already exist -- if true: exit, else: execute (parameter used is -e/-f/-x for exists/regular_file/executable)
	if [ -f $FILE.pcap && -f $FILE.strace ];
	then
		echo "File already exists"
		exit
	else	
		tcpdump -i eth0 -n host 10.0.2.15 -c 15 -w $FILE.pcap
		echo "Starting tcpdump"
		echo $FILE
		chmod +x $FILE 
		# executable file required after the -o option <output>.strace <executable>	
		strace -f -q -s 100 -o $FILE.strace ./$FILE
		echo "strace up and running"
	fi

	echo "Done listening"
else
	echo "Malware sample to execute not found"
	exit
fi

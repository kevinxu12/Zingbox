#!/bin/bash

lockfile='lockfile_scp_malware.txt'
portfile='portnum_check.txt'

cd $1

if [ -f $lockfile ]; then
    	echo "File Already Exists"
	exit
fi

date >  $lockfile

echo "Running time: starts at ", `date` 

if [ -f $portfile ]; then
	portnum=`cat $portfile`
	echo "The port number is $portnum"
else 
	echo "COULD NOT ACCESS PORT# FILE"
fi

cd .. 

if [ "$2" = "" ]; then
	sh scp_qemu_script.sh $1 $portnum
else
	echo "Pre-specified malware sample argument passed: $2"
	sh scp_qemu_script.sh $1 $portnum $2
fi

echo "Running time: finish at ", `date`

cd $1
rm $lockfile

cd ..
